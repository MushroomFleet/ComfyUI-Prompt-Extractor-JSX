![License](https://img.shields.io/badge/license-MIT-blue.svg)
![React](https://img.shields.io/badge/React-16.8+-61DAFB.svg?logo=react)
![Zero Dependencies](https://img.shields.io/badge/dependencies-zero-green.svg)

# ComfyUI Prompt Extractor JSX

A lightweight React component for extracting text prompts from ComfyUI-generated PNG images by parsing embedded metadata non-destructively.

Live Demo: https://scuffedepoch.com/prompt-extractor/

## âœ¨ Features

- **Non-destructive parsing** â€” reads PNG chunk metadata without modifying image data
- **Zero dependencies** â€” uses native browser APIs only
- **Drag-and-drop support** â€” intuitive file upload experience
- **Image preview** â€” displays uploaded image alongside extracted prompt
- **One-click download** â€” save extracted prompt as `.txt` with matching filename
- **Full metadata access** â€” exposes complete workflow and prompt JSON
- **TypeScript ready** â€” includes type definitions for TS projects

## ğŸš€ Quick Start

### Try the Demo

Open `demo.html` in your browser for an instant preview. No build tools required â€” it uses Babel standalone for JSX transformation.

```bash
# Clone the repository
git clone https://github.com/MushroomFleet/ComfyUI-Prompt-Extractor-JSX.git

# Open the demo
open demo.html
# or on Linux
xdg-open demo.html
```

### Test File Included

Use `test_comfyui_image.png` to verify the extractor works. This PNG contains embedded ComfyUI-style metadata with a sample prompt.

## ğŸ“¦ Installation

Copy `comfyprompt-extractor.jsx` into your project:

```
src/
  components/
    comfyprompt-extractor.jsx
```

## ğŸ’» Basic Usage

```jsx
import React from 'react';
import { useComfyPromptExtractor } from './comfyprompt-extractor';

function App() {
  const extractor = useComfyPromptExtractor({
    onPromptExtracted: (prompt, filename, metadata) => {
      console.log('Prompt:', prompt);
    },
    onError: (message) => {
      console.error('Error:', message);
    }
  });

  return (
    <div>
      <input
        ref={extractor.fileInputRef}
        type="file"
        accept="image/png"
        onChange={extractor.handleFileChange}
        style={{ display: 'none' }}
      />
      
      <button onClick={extractor.triggerFileInput}>
        Upload ComfyUI PNG
      </button>
      
      {extractor.isProcessing && <p>Extracting...</p>}
      
      {extractor.extractedPrompt && (
        <div>
          <img src={extractor.imagePreview} alt="Preview" width={200} />
          <pre>{extractor.extractedPrompt}</pre>
          <button onClick={extractor.savePrompt}>
            Download as .txt
          </button>
        </div>
      )}
    </div>
  );
}
```

## ğŸ“– How It Works

ComfyUI embeds workflow and prompt data in PNG files using standard `tEXt` and `iTXt` chunks. This component:

1. Validates the PNG file signature
2. Parses PNG chunks to find text metadata
3. Extracts `workflow` and `prompt` JSON data
4. Recursively searches all string values
5. Returns the longest string (typically the positive prompt)

The image data itself is never modified â€” only the metadata header is read.

## ğŸ”§ API Reference

### Hook: `useComfyPromptExtractor(options)`

#### Options

| Option | Type | Description |
|--------|------|-------------|
| `onPromptExtracted` | `(prompt, filename, metadata) => void` | Called on successful extraction |
| `onError` | `(message) => void` | Called when extraction fails |

#### Returns

| Property | Type | Description |
|----------|------|-------------|
| `isProcessing` | `boolean` | Loading state |
| `extractedPrompt` | `string \| null` | The extracted prompt |
| `fileName` | `string \| null` | Source filename (without extension) |
| `imagePreview` | `string \| null` | Object URL for preview |
| `metadata` | `object \| null` | Full parsed metadata |
| `fileInputRef` | `RefObject` | Attach to file input element |
| `processFile` | `(file) => void` | Manual file processing |
| `handleFileChange` | `(event) => void` | Input change handler |
| `handleDrop` | `(event) => void` | Drop handler |
| `handleDragOver` | `(event) => void` | Drag over handler |
| `savePrompt` | `() => void` | Download prompt as .txt |
| `triggerFileInput` | `() => void` | Open file picker |
| `reset` | `() => void` | Clear all state |

## âš ï¸ Common Issues

### "File is not a PNG"

The file may be a JPEG with a `.png` extension. This commonly happens when:
- Images are downloaded from social media
- Screenshots are auto-saved as JPEG
- Files are converted without metadata preservation

**Solution:** Use the original PNG from ComfyUI's output directory.

### "No metadata found"

The PNG exists but lacks ComfyUI data. Causes:
- Re-saved in an image editor
- Uploaded to a service that strips metadata
- Generated by a tool other than ComfyUI

## ğŸ“ Project Structure

```
ComfyUI-Prompt-Extractor-JSX/
â”œâ”€â”€ README.md                                    # This file
â”œâ”€â”€ comfyprompt-extractor.jsx                   # Main component
â”œâ”€â”€ demo.html                                    # Interactive demo
â”œâ”€â”€ test_comfyui_image.png                      # Test file with metadata
â””â”€â”€ ComfyUI-Prompt-Extractor-JSX-integration.md # Developer guide
```

## ğŸŒ Browser Support

- Chrome 80+
- Firefox 75+
- Safari 13.1+
- Edge 80+

Requires: `File.arrayBuffer()`, `DataView`, `TextDecoder`

## ğŸ“š Documentation

For detailed integration instructions, customization options, and advanced usage examples, see:

**[ComfyUI-Prompt-Extractor-JSX-integration.md](./ComfyUI-Prompt-Extractor-JSX-integration.md)**

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## ğŸ“„ License

MIT License â€” use freely in personal and commercial projects.

---

## ğŸ“š Citation

### Academic Citation

If you use this codebase in your research or project, please cite:

```bibtex
@software{comfyui_prompt_extractor_jsx,
  title = {ComfyUI-Prompt-Extractor-JSX: A React component for extracting text prompts from ComfyUI PNG metadata},
  author = {Drift Johnson},
  year = {2025},
  url = {https://github.com/MushroomFleet/ComfyUI-Prompt-Extractor-JSX},
  version = {1.0.0}
}
```

### Donate:

[![Ko-Fi](https://cdn.ko-fi.com/cdn/kofi3.png?v=3)](https://ko-fi.com/driftjohnson)
